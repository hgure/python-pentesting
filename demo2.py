#!/usr/bin/env python3
"""Command-line interface to perform several security tests."""


from lxml import html
import nmap3
import requests
import whois
import typer

app = typer.Typer()


def get_page(url: str, proxy: str = None):
    """Perform a GET request and return response object."""
    proxies = None
    if proxy:
        proxies = {"http": f"http://{proxy}"}
    response = requests.get(url, proxies=proxies)
    return response


@app.command()
def forms(url: str, proxy: str = None):
    """Find a form in a page, and print form details."""
    response = get_page(url, proxy)
    tree = html.fromstring(response.content)
    for form in tree.xpath("//form"):
        print(f"Found a {form.method} form for {form.action}")
        for field in form.fields:
            print(f"Contains input field {field}")


@app.command()
def domain(name: str):
    """Print the domain registrant's name and organization."""
    results = whois.whois(name)
    print(f"{name} is registered by {results.name} - {results.org}")


@app.command()
def portscan(target: str, top: int = 10):
    """Perform a portscan against a target on the top TOP ports,
    and print the open ports and services."""
    nmap = nmap3.Nmap()
    results = nmap.scan_top_ports(target, default=top)
    ip, *_unused = results.keys()
    for port in results[ip]["ports"]:
        if "open" in port["state"]:
            print(f"{port['portid']} {port['service']['name']}")


if __name__ == "__main__":
    app()


"""This script is a command-line interface that performs several security tests on a given input. It uses the following libraries: 'lxml', 'nmap3', 'requests', 'whois', and 'typer'. The script defines three commands: 'forms', 'domain', and 'portscan'. The 'forms' command takes a URL and an optional proxy and finds forms in the page and prints form details. The 'domain' command takes a domain name and prints the domain registrant's name and organization. The 'portscan' command takes a target and an optional top number of ports to scan and performs a port scan against the target on the top ports and prints the open ports and services"""
